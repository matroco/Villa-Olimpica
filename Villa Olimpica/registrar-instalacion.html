<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Gesti√≥n de Instalaciones ‚Äî Villa Ol√≠mpica</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;500;700;900&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-dark: #0f172a; /* Fondo principal */
            --card-bg: rgba(30, 41, 59, 0.7); /* Fondo de tarjetas glass */
            --primary: #3b82f6; /* Azul Primario */
            --accent: #22d3ee; /* Cian/Aciento */
            --text-light: #f8fafc; /* Texto principal claro */
            --text-muted: #94a3b8; /* Texto secundario gris azulado */
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-dark);
            /* Fondo deportivo sutil del dashboard */
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(59, 130, 246, 0.15) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(34, 211, 238, 0.1) 0%, transparent 20%);
            color: var(--text-light); /* Texto claro por defecto */
            margin: 0;
            min-height: 100vh;
        }

        /* Scrollbar invisible */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Efecto Cristal (Glassmorphism) - REEMPLAZA .card */
        .glass-panel {
            background: var(--card-bg);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 20px;
            transition: all 0.3s ease;
        }
        .glass-panel:hover {
            border-color: rgba(255, 255, 255, 0.2);
        }
        .text-glow { text-shadow: 0 0 20px rgba(34, 211, 238, 0.3); }

        /* Contenedor principal para centrar el contenido */
        .main-container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 32px 24px;
        }

        /* Estilo de los Inputs/Selects - ADAPTADO A DARK */
        .form-input {
            width: 100%;
            margin-top: 4px;
            padding: 10px;
            border-radius: 8px; /* Ligeramente m√°s redondeado */
            background: rgba(255, 255, 255, 0.05); /* Fondo muy sutil */
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--text-light);
            transition: all 0.2s;
        }
        .form-input:focus {
            border-color: var(--accent); /* Resalta con el color accent */
            outline: none;
            box-shadow: 0 0 0 1px var(--accent);
            background: rgba(255, 255, 255, 0.1);
        }
        .form-input::placeholder {
            color: var(--text-muted);
            opacity: 0.6;
        }

        .form-label {
            font-size: 0.875rem; /* text-sm */
            font-weight: 500;
            color: var(--text-muted);
        }

        /* Estilo de la lista de instalaciones */
        .list-item {
            background: rgba(255, 255, 255, 0.03); /* Fondo sutil */
            border-radius: 12px;
            padding: 12px 16px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.2s;
        }
        .list-item:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.15);
        }

        /* Botones */
        .btn-primary {
            background: linear-gradient(90deg, var(--primary), var(--accent));
            color: white;
            padding: 10px 18px;
            border-radius: 8px;
            font-weight: 700;
            transition: opacity 0.2s;
            box-shadow: 0 4px 10px rgba(59, 130, 246, 0.3);
        }
        .btn-primary:hover {
            opacity: 0.9;
        }
        .btn-secondary {
            background: #475569; /* Slate 600 */
            color: white;
            padding: 10px 18px;
            border-radius: 8px;
            font-weight: 600;
            transition: background-color 0.2s;
        }
        .btn-secondary:hover {
            background: #334155; /* Slate 700 */
        }
        .btn-action-detail {
             background: #0f172a; /* Fondo dark */
             color: var(--accent);
             border: 1px solid var(--accent);
             box-shadow: 0 0 10px rgba(34, 211, 238, 0.2);
        }
        .btn-action-edit {
             background: #422006; /* Oscuro ambar */
             color: #f59e0b;
             border: 1px solid #f59e0b;
        }
        .btn-action-delete {
             background: #450a0a; /* Oscuro rojo */
             color: #f87171;
             border: 1px solid #f87171;
        }
        .btn-action-detail:hover { background: #0f172a; }
        .btn-action-edit:hover { background: #451a03; }
        .btn-action-delete:hover { background: #450a0a; }

        /* Modal - Adaptado a Dark */
        .modal-bg{
          position:fixed; inset:0;
          background:rgba(0,0,0,0.7); /* Fondo m√°s oscuro */
          backdrop-filter: blur(5px);
          display:flex; align-items:center; justify-content:center;
          z-index:50;
        }
        .modal{
          background:var(--card-bg); 
          backdrop-filter: blur(20px);
          padding:24px;
          border-radius:20px; 
          width:90%; 
          max-width:480px;
          color: var(--text-light);
          border: 1px solid rgba(255, 255, 255, 0.1);
          box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
        }
    </style>
</head>

<body>

<header class="bg-[#0f172a]/80 backdrop-blur-sm border-b border-white/5 sticky top-0 z-10">
    <div class="main-container flex justify-between items-center py-4">
        <div class="flex items-center gap-3">
            <div class="w-9 h-9 rounded-xl bg-gradient-to-br from-blue-600 to-cyan-500 flex items-center justify-center text-white font-black text-xl shadow-lg shadow-blue-500/20">
                V
            </div>
            <div class="text-xl font-bold text-white tracking-tight">
                Gesti√≥n de Instalaciones
            </div>
        </div>
        <a href="menu-gestion.html" class="px-3 py-1.5 rounded-full border border-white/10 text-sm font-medium text-slate-300 hover:bg-white/5 transition-colors">
            ‚Üê Atras
        </a>
    </div>
</header>


<div class="main-container">

    <h1 class="text-3xl font-extrabold mb-6 text-white tracking-tight text-glow">
        <span class="text-4xl">üèüÔ∏è</span> Registrar/Editar Instalaci√≥n
    </h1>

    <section class="glass-panel mb-8 p-6">
        <form id="formInst" class="grid grid-cols-1 md:grid-cols-3 gap-6">

            <input type="hidden" id="instId">

            <div class="space-y-4">
                <h3 class="font-bold text-lg border-b border-white/10 pb-2 mb-2 text-white">Informaci√≥n B√°sica</h3>
                <div>
                    <label class="form-label" for="nombre">Nombre</label>
                    <input id="nombre" class="form-input" required>
                </div>

                <div>
                    <label class="form-label" for="ubicacion">Ubicaci√≥n</label>
                    <input id="ubicacion" class="form-input" required placeholder="Ej: Sector C, cerca del gimnasio">
                </div>
                <div>
                    <label class="form-label" for="tipo">Tipo de Instalaci√≥n</label>
                    <select id="tipo" class="form-input">
                        <option value="cancha">Cancha</option>
                        <option value="gimnasio">Gimnasio</option>
                        <option value="piscina">Piscina</option>
                        <option value="pista">Pista</option>
                        <option value="sala">Sala</option>
                        <option value="otro">Otro</option>
                    </select>
                </div>
            </div>

            <div class="space-y-4">
                <h3 class="font-bold text-lg border-b border-white/10 pb-2 mb-2 text-white">Dimensiones y Capacidad</h3>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="form-label" for="largo">Largo (m)</label>
                        <input id="largo" type="number" step="0.1" class="form-input" placeholder="Ej: 40.5">
                    </div>
                    <div>
                        <label class="form-label" for="ancho">Ancho (m)</label>
                        <input id="ancho" type="number" step="0.1" class="form-input" placeholder="Ej: 20">
                    </div>
                </div>

                <div>
                    <label class="form-label" for="capacidad">Capacidad (personas)</label>
                    <input id="capacidad" type="number" class="form-input" placeholder="Ej: 20">
                </div>

                <div>
                    <label class="form-label" for="estado">Estado Operacional</label>
                    <select id="estado" class="form-input">
                        <option value="activa">Activa (Disponible)</option>
                        <option value="inactiva">Inactiva (Fuera de servicio)</option>
                        <option value="mantenimiento">Mantenimiento (Temporalmente cerrado)</option>
                    </select>
                </div>
            </div>

            <div class="space-y-4">
                <h3 class="font-bold text-lg border-b border-white/10 pb-2 mb-2 text-white">Detalles Adicionales</h3>
                <div>
                    <label class="form-label" for="descripcion">Descripci√≥n</label>
                    <textarea id="descripcion" rows="5" class="form-input" placeholder="Ej: Cancha de baloncesto reglamentaria con piso de madera y gradas para 500 personas."></textarea>
                </div>
                
                <div class="flex gap-3 pt-4">
                    <button type="submit" class="btn-primary flex-1">Guardar Instalaci√≥n</button>
                    <button id="btnClear" type="button" class="btn-secondary">Limpiar</button>
                </div>
            </div>

        </form>
    </section>

    <section class="glass-panel p-6">
        <h2 class="text-xl font-bold mb-4 text-white">Listado de Instalaciones Registradas</h2>
        <div id="tblInstalaciones" class="space-y-2">Cargando...</div>
    </section>
</div>

<div id="modalVer" class="modal-bg hidden">
    <div class="modal">
        <h2 class="text-2xl font-bold mb-4 border-b border-white/10 pb-2 text-white">Detalles de la Instalaci√≥n</h2>
        <div id="modalContent" class="space-y-3 text-sm text-slate-200"></div>
        <button onclick="closeModal()" class="mt-6 w-full py-2 btn-primary">Cerrar</button>
    </div>
</div>

<script type="module">
import { createClient } from "https://esm.sh/@supabase/supabase-js";

// ‚ö†Ô∏è NOTA: Aseg√∫rate de que estas claves sean correctas y est√©n activas.
const supabase = createClient(
    "https://wzovzfrrgknhvcozektc.supabase.co",
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Ind6b3Z6ZnJyZ2tuaHZjb3pla3RjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI1MzYyMTAsImV4cCI6MjA3ODExMjIxMH0.zhbQqSEje7RGhZpJlUEaGZ07nuCOCamQI7S97rf-Tfo"
);

// Elementos del formulario 
const instId = document.getElementById("instId");
const formInst = document.getElementById("formInst");
const nombre = document.getElementById("nombre");
const ubicacion = document.getElementById("ubicacion"); 
const tipo = document.getElementById("tipo");
const estado = document.getElementById("estado");
const largo = document.getElementById("largo");
const ancho = document.getElementById("ancho");
const capacidad = document.getElementById("capacidad");
const descripcion = document.getElementById("descripcion");
const modalVer = document.getElementById("modalVer");
const modalContent = document.getElementById("modalContent");


/* ---------------------
    CARGAR LISTADO - MUESTRA AHORA UBICACI√ìN
---------------------- */
async function cargarInstalaciones() {
    const { data, error } = await supabase
        .from("instalaciones")
        .select("*")
        .order("nombre");

    if (error) {
        document.getElementById("tblInstalaciones").textContent = "Error al cargar el listado de instalaciones.";
        return;
    }

    // CLASES ADAPTADAS AL TEMA OSCURO
    const estadoClases = {
        'activa': 'bg-green-700/30 text-green-300 border border-green-700',
        'inactiva': 'bg-red-700/30 text-red-300 border border-red-700',
        'mantenimiento': 'bg-yellow-700/30 text-yellow-300 border border-yellow-700',
    };

    document.getElementById("tblInstalaciones").innerHTML = data.map(inst => `
        <div class="list-item flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3">
            <div class="flex-1 min-w-0">
                <div class="font-bold text-white">${inst.nombre} <span class="text-xs font-normal text-slate-400">(${inst.ubicacion})</span></div>
                <div class="text-slate-500 text-xs mt-1">
                    ${inst.tipo ?? "‚Äî"} | Capacidad: ${inst.capacidad ?? "?"} pers.
                </div>
            </div>

            <div class="flex items-center gap-4">
                <span class="px-3 py-1 rounded-full text-xs font-semibold ${estadoClases[inst.estado] || 'bg-slate-700/30 text-slate-400 border border-slate-700'}">
                    ${inst.estado}
                </span>

                <div class="flex gap-2">
                    <button onclick='verMas(${JSON.stringify(inst)})'
                            class="px-3 py-1 rounded text-xs font-medium btn-action-detail">Detalles</button>
                    <button onclick='editar(${JSON.stringify(inst)})'
                            class="px-3 py-1 rounded text-xs font-medium btn-action-edit">Editar</button>
                    <button onclick='eliminar("${inst.id}")'
                            class="px-3 py-1 rounded text-xs font-medium btn-action-delete">Eliminar</button>
                </div>
            </div>
        </div>
    `).join("");
}

/* ---------------------
     GUARDAR / UPDATE - USA AHORA 'ubicacion'
---------------------- */
formInst.addEventListener("submit", async (e) => {
    e.preventDefault();

    const inst = {
        nombre: nombre.value,
        ubicacion: ubicacion.value,
        tipo: tipo.value,
        estado: estado.value,
        largo: largo.value ? Number(largo.value) : null,
        ancho: ancho.value ? Number(ancho.value) : null,
        capacidad: capacidad.value ? Number(capacidad.value) : null,
        descripcion: descripcion.value
    };

    if (instId.value) {
        const { error } = await supabase.from("instalaciones").update(inst).eq("id", instId.value);
        if (error) alert("Error al actualizar: " + error.message);
    } else {
        const { error } = await supabase.from("instalaciones").insert(inst);
        if (error) alert("Error al guardar: " + error.message);
    }

    limpiarFormulario();
    cargarInstalaciones();
});

/* ---------------------
     EDITAR - USA AHORA 'ubicacion'
---------------------- */
window.editar = (inst) => {
    instId.value = inst.id;
    nombre.value = inst.nombre;
    ubicacion.value = inst.ubicacion; 
    tipo.value = inst.tipo ?? "otro";
    estado.value = inst.estado;
    largo.value = inst.largo ?? "";
    ancho.value = inst.ancho ?? "";
    capacidad.value = inst.capacidad ?? "";
    descripcion.value = inst.descripcion ?? "";
    window.scrollTo({ top: 0, behavior: 'smooth' });
};

/* ---------------------
     ELIMINAR
---------------------- */
window.eliminar = async (id) => {
    if (!confirm("¬øSeguro que deseas eliminar esta instalaci√≥n? Esta acci√≥n es irreversible.")) return;
    const { error } = await supabase.from("instalaciones").delete().eq("id", id);
    if (error) alert("Error al eliminar: " + error.message);
    cargarInstalaciones();
};

/* ---------------------
     VER M√ÅS - MUESTRA AHORA UBICACI√ìN
---------------------- */
window.verMas = (inst) => {
    modalVer.classList.remove("hidden");

    modalContent.innerHTML = `
        <p><strong>Nombre:</strong> <span class="text-white">${inst.nombre}</span></p>
        <p><strong>Ubicaci√≥n:</strong> <span class="text-white">${inst.ubicacion}</span></p>
        <p><strong>Tipo:</strong> <span class="text-white">${inst.tipo ?? "‚Äî"}</span></p>
        <p><strong>Estado:</strong> <span class="font-bold text-lg text-white">${inst.estado}</span></p>
        <hr class="my-2 border-white/10">
        <p><strong>Largo:</strong> <span class="text-white">${inst.largo ? inst.largo + " m" : "?"}</span></p>
        <p><strong>Ancho:</strong> <span class="text-white">${inst.ancho ? inst.ancho + " m" : "?"}</span></p>
        <p><strong>Capacidad:</strong> <span class="text-white">${inst.capacidad ?? "?"} personas</span></p>
        <p class="pt-3"><strong>Descripci√≥n:</strong></p>
        <p class="bg-white/5 p-3 rounded-lg border border-white/10 text-slate-300">${inst.descripcion ?? "No hay descripci√≥n detallada."}</p>
    `;
};

window.closeModal = () => modalVer.classList.add("hidden");

/* ---------------------
     LIMPIAR
---------------------- */
function limpiarFormulario() {
    instId.value = "";
    formInst.reset();
}
document.getElementById("btnClear").onclick = limpiarFormulario;

/* ---------------------
     INIT
---------------------- */
cargarInstalaciones();
</script>

</body>
</html>