<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gestión de Instalaciones</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        :root {
            --primary: #1d4ed8;
            --accent: #22c55e;
            --glass: rgba(255, 255, 255, 0.03);
        }

        .sidebar {
            width: 260px;
            padding: 24px;
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.02), rgba(255, 255, 255, 0.01));
            min-height: 100vh;
        }

        .menu-item {
            padding: 8px 10px;
            border-radius: 8px;
            display: block;
            color: #dbeafe;
            text-decoration: none;
            font-size: 0.92rem;
        }

        .menu-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .hidden-el {
            display: none;
        }

        .small-muted {
            color: rgba(230, 238, 248, 0.65);
            font-size: .9rem;
        }

        body {
            margin: 0;
            background: linear-gradient(180deg, #041033, #07132a);
            color: white;
            font-family: 'Inter', sans-serif;
        }

        .tab-active {
            border-bottom: 2px solid #3b82f6;
            color: #3b82f6;
        }

        select,
        option {
            color: inherit;
            background: transparent;
        }

        .card {
            background: rgba(255, 255, 255, 0.04);
            border-radius: 10px;
            padding: 12px;
        }

        .muted {
            color: #9ca3af;
        }

        /* Modal styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            animation: fadeIn 0.2s ease-out;
        }

        .modal-content {
            background: #1a1f3a;
            border-radius: 16px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(15, 23, 42, 0.8);
            position: relative;
            border: 1px solid rgba(148, 163, 184, 0.35);
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 24px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.06);
            background: radial-gradient(circle at top left, rgba(56, 189, 248, 0.18), transparent 55%);
        }

        .modal-body {
            padding: 20px 24px;
            max-height: calc(90vh - 140px);
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: rgba(148, 163, 184, 0.9) transparent;
        }

        .modal-body::-webkit-scrollbar {
            width: 6px;
        }

        .modal-body::-webkit-scrollbar-track {
            background: transparent;
        }

        .modal-body::-webkit-scrollbar-thumb {
            background: rgba(148, 163, 184, 0.9);
            border-radius: 999px;
        }

        .modal-title {
            font-size: 1.05rem;
            font-weight: 600;
            letter-spacing: 0.02em;
        }

        .modal-subtitle {
            font-size: 0.85rem;
            color: #9ca3af;
            margin-top: 2px;
        }

        .close-btn {
            border: none;
            background: transparent;
            color: #9ca3af;
            font-size: 1.3rem;
            cursor: pointer;
            padding: 4px;
            border-radius: 999px;
            transition: all 0.15s ease-out;
        }

        .close-btn:hover {
            background: rgba(148, 163, 184, 0.15);
            color: #e5e7eb;
            transform: scale(1.03);
        }

        .modal-footer {
            padding: 16px 24px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            font-size: 0.85rem;
            font-weight: 500;
            color: #e5e7eb;
            margin-bottom: 6px;
        }

        .form-hint {
            font-size: 0.75rem;
            color: #9ca3af;
            margin-top: 4px;
        }

        .form-input,
        .form-textarea {
            width: 100%;
            background: rgba(15, 23, 42, 0.8);
            border-radius: 10px;
            border: 1px solid rgba(148, 163, 184, 0.5);
            padding: 8px 10px;
            color: #e5e7eb;
            font-size: 0.9rem;
            transition: all 0.15s ease-out;
        }

        .form-input:focus,
        .form-textarea:focus {
            outline: none;
            border-color: #60a5fa;
            box-shadow: 0 0 0 1px rgba(96, 165, 250, 0.6);
        }

        .form-textarea {
            min-height: 80px;
            resize: vertical;
        }

        .btn-primary {
            padding: 8px 16px;
            border-radius: 999px;
            border: none;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            background: linear-gradient(90deg, #3b82f6, #22c55e);
            color: white;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 12px 30px rgba(37, 99, 235, 0.45);
        }

        .btn-secondary {
            padding: 8px 16px;
            border-radius: 999px;
            border: 1px solid rgba(148, 163, 184, 0.6);
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            background: rgba(15, 23, 42, 0.9);
            color: #e5e7eb;
        }

        .badge-soft {
            display: inline-flex;
            align-items: center;
            padding: 3px 9px;
            border-radius: 999px;
            font-size: 0.75rem;
            background: rgba(37, 99, 235, 0.14);
            color: #bfdbfe;
            border: 1px solid rgba(59, 130, 246, 0.5);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(4px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Arreglar visibilidad en selects */
        select option {
            color: black !important;
            background: white !important;
        }

        /* Si quieres que el menú se vea oscuro */
        select option.dark {
            color: white !important;
            background: #1e293b !important;
        }
    </style>
</head>

<body>
    <div class="flex">

        <!-- SIDEBAR -->
        <aside class="sidebar">

            <div class="flex items-center gap-3 mb-6">
                <div
                    style="width:44px;height:44px;background:linear-gradient(90deg,var(--primary),var(--accent));border-radius:8px;display:flex;align-items:center;justify-content:center;font-weight:800;">
                    V
                </div>
                <div>
                    <div class="font-bold">Villa Olímpica</div>
                    <div class="text-xs small-muted">Gestión de Instalaciones</div>
                </div>
            </div>

            <nav class="space-y-2">
                <a class="menu-item" href="menu-gestion.html#dashboard">Dashboard</a>

                <!-- Instalaciones dinámicas -->
                <div>
                    <button id="toggleInst" type="button" class="menu-item flex items-center justify-between w-full">
                        <span>Instalaciones</span>
                        <svg id="chev" class="w-4 h-4 transform transition-transform" fill="none" stroke="currentColor"
                            viewBox="0 0 24 24">
                            <path stroke-width="2" d="M19 9l-7 7-7-7" />
                        </svg>
                    </button>
                    <div id="instList" class="mt-2 space-y-1 hidden-el"></div>
                </div>

                <a class="menu-item" href="reservas-gestion.html">Reservas</a>
                <a class="menu-item" href="actividades-gestion.html">Actividades</a>
            </nav>

            <div class="mt-8">
                <button id="btnLogout" class="w-full py-2 rounded text-white"
                    style="background:linear-gradient(90deg,var(--primary),var(--accent));">
                    Cerrar sesión
                </button>
            </div>

        </aside>

        <!-- MAIN -->
        <main class="flex-1 p-6">
            <h1 class="text-2xl font-bold mb-6">Gestión de Instalaciones</h1>

            <div class="max-w-3xl">
                <label class="block mb-4">
                    <span class="muted">Seleccione instalación</span>
                    <select id="instalacion"
                        class="w-full mt-2 p-2 bg-white/5 border border-white/10 rounded text-white"></select>
                </label>

                <div id="infoInstalacion" class="mb-6 card hidden">
                    <p class="font-semibold" id="instNombre"></p>
                    <p class="muted text-sm" id="instDescripcion"></p>
                    <p class="muted text-sm">Estado: <span id="instEstado"></span></p>
                </div>

                <div class="flex gap-6 mb-6">
                    <button id="tabInventario" class="pb-2 tab-active" onclick="cambiarTab('inv')">
                        Inventario
                    </button>
                    <button id="tabMantenimiento" class="pb-2" onclick="cambiarTab('mant')">
                        Mantenimiento
                    </button>
                </div>

                <!-- Inventario -->
                <div id="panelInventario">
                    <h2 class="text-xl font-semibold mb-3">Inventario</h2>

                    <div class="mb-4 p-4 bg-white/5 rounded">
                        <h3 class="font-semibold mb-2">Agregar nuevo</h3>
                        <input id="invNombre" class="w-full p-2 bg-white/10 rounded mb-2" placeholder="Nombre" />
                        <input id="invCantidad" type="number" min="1" class="w-full p-2 bg-white/10 rounded mb-2"
                            placeholder="Cantidad" />
                        <select id="invEstado" class="w-full p-2 bg-white/10 rounded mb-2 text-white">
                            <option value="">-- Seleccionar estado --</option>
                            <option value="funcional">Funcional</option>
                            <option value="dañado">Dañado</option>
                            <option value="mantenimiento">En mantenimiento</option>
                        </select>

                        <input id="invCondicion" class="w-full p-2 bg-white/10 rounded mb-2" placeholder="Condición" />
                        <textarea id="invObs" class="w-full p-2 bg-white/10 rounded mb-2"
                            placeholder="Observaciones"></textarea>
                        <div class="flex gap-2">
                            <button onclick="agregarInventario()"
                                class="mt-2 px-4 py-2 bg-blue-600 rounded">Guardar</button>
                            <button onclick="refrescarInventario()"
                                class="mt-2 px-4 py-2 bg-gray-600 rounded">Refrescar</button>
                        </div>
                    </div>

                    <div id="inventarioLista" class="space-y-2"></div>
                </div>

                <!-- Mantenimiento -->
                <div id="panelMantenimiento" class="hidden">
                    <div class="flex items-center justify-between mb-3">
                        <h2 class="text-xl font-semibold">Mantenimientos</h2>
                        <button class="px-3 py-1 rounded bg-blue-600 text-sm" onclick="abrirModalMantenimiento()">
                            Nuevo mantenimiento
                        </button>
                    </div>

                    <div id="mantenimientoLista" class="space-y-2"></div>
                </div>
            </div>

        </main>
    </div>

    <!-- Modal para crear/editar mantenimiento -->
    <div id="modalEditarMantenimiento" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <div>
                    <h3 class="modal-title" id="modalMantTitulo">Nuevo mantenimiento</h3>
                    <p class="modal-subtitle" id="modalMantSubtitulo">Registra o actualiza un mantenimiento de la
                        instalación seleccionada.</p>
                </div>
                <button class="close-btn" onclick="cerrarModalMantenimiento()">×</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Tipo de Mantenimiento *</label>
                    <input type="text" id="modalMantTipo" class="form-input"
                        placeholder="Ej: Preventivo, Correctivo, etc." />
                </div>

                <div class="form-group">
                    <label class="form-label">Fecha</label>
                    <input type="date" id="modalMantFecha" class="form-input" />
                    <p class="form-hint">Seleccione la fecha del mantenimiento (si aplica).</p>
                </div>

                <div class="form-group">
                    <label class="form-label">Responsable</label>
                    <input type="text" id="modalMantResp" class="form-input"
                        placeholder="Nombre o equipo responsable" />
                </div>

                <div class="form-group">
                    <label class="form-label">Detalles</label>
                    <textarea id="modalMantDetalles" class="form-textarea"
                        placeholder="Describa las actividades realizadas, partes reemplazadas, recomendaciones, etc."></textarea>
                </div>

                <div class="form-group">
                    <span class="badge-soft">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 mr-1" viewBox="0 0 20 20"
                            fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v4a1 1 0 00.293.707l2 2a1 1 0 001.414-1.414L11 10.586V7z"
                                clip-rule="evenodd" />
                        </svg>
                        Los cambios se guardan en la bitácora de mantenimientos
                    </span>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="cerrarModalMantenimiento()">Cancelar</button>
                <button class="btn-primary" onclick="guardarCambiosMantenimiento()">
                    Guardar cambios
                </button>
            </div>
        </div>
    </div>

    <script type="module">
        import { createClient } from "https://esm.sh/@supabase/supabase-js";

        const SUPABASE_URL = "https://wzovzfrrgknhvcozektc.supabase.co";
        const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Ind6b3Z6ZnJyZ2tuaHZjb3pla3RjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI1MzYyMTAsImV4cCI6MjA3ODExMjIxMH0.zhbQqSEje7RGhZpJlUEaGZ07nuCOCamQI7S97rf-Tfo";


        const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);
        const params = new URLSearchParams(window.location.search);
        const instCodigo = params.get("codigo") || null;

        function safeEl(id) {
            return document.getElementById(id);
        }

        // Cargar instalaciones en select
        window.cargarInstalaciones = async function cargarInstalaciones() {
            try {
                const { data, error } = await supabase
                    .from("instalaciones")
                    .select("id, nombre, descripcion, estado, codigo")
                    .order("nombre");

                if (error) throw error;

                const sel = safeEl("instalacion");
                sel.innerHTML = '<option value="">-- Seleccione --</option>';

                let selectedIndex = 0;

                if (data && data.length) {
                    data.forEach((i, idx) => {
                        const opt = document.createElement("option");
                        opt.value = i.id;
                        opt.textContent = i.nombre;
                        opt.dataset.codigo = i.codigo || "";
                        sel.appendChild(opt);

                        if (instCodigo && i.codigo === instCodigo) {
                            selectedIndex = idx + 1;
                        }
                    });

                    if (selectedIndex === 0 && sel.options.length > 1) {
                        selectedIndex = 1;
                    }

                    sel.selectedIndex = selectedIndex;
                    actualizarInfoInstalacion();
                    await cargarInventario();
                    await cargarMantenimientos();
                }
            } catch (err) {
                console.error("cargarInstalaciones:", err);
                alert("Error al cargar instalaciones (ver consola).");
            }
        };

        // Info instalación seleccionada
        window.actualizarInfoInstalacion = async function actualizarInfoInstalacion() {
            const sel = safeEl("instalacion");
            const infoCard = safeEl("infoInstalacion");
            const id = sel.value;
            if (!id) {
                infoCard.classList.add("hidden");
                return;
            }
            const opt = sel.options[sel.selectedIndex];
            safeEl("instNombre").textContent = opt ? opt.textContent : "";
            try {
                const { data } = await supabase
                    .from("instalaciones")
                    .select("descripcion, estado")
                    .eq("id", id)
                    .single();
                safeEl("instDescripcion").textContent = data?.descripcion ?? "";
                safeEl("instEstado").textContent = data?.estado ?? "";
                infoCard.classList.remove("hidden");
            } catch (e) {
                safeEl("instDescripcion").textContent = "";
                safeEl("instEstado").textContent = "";
                infoCard.classList.remove("hidden");
            }
        };

        // Inventario: listar
        window.cargarInventario = async function cargarInventario() {
            try {
                const id = safeEl("instalacion").value;
                if (!id) {
                    safeEl("inventarioLista").innerHTML = "<p class='muted'>Seleccione una instalación.</p>";
                    return;
                }
                const { data, error } = await supabase
                    .from("inventario_instalacion")
                    .select("id, instalacion_id, nombre, cantidad, estado, condicion, observaciones, created_at, updated_at")
                    .eq("instalacion_id", id)
                    .order("created_at", { ascending: false });
                if (error) throw error;
                const cont = safeEl("inventarioLista");
                cont.innerHTML = "";
                if (!data || data.length === 0) {
                    cont.innerHTML = "<p class='muted'>No hay elementos registrados.</p>";
                    return;
                }
                data.forEach(item => {
                    const div = document.createElement("div");
                    div.className = "p-3 rounded bg-white/5 flex justify-between";
                    div.innerHTML = `
            <div>
              <p class="font-semibold">${item.nombre} <span class="text-sm text-gray-400">x${item.cantidad}</span></p>
              <p class="text-sm text-gray-400">Estado: ${item.estado || "N/D"} • Condición: ${item.condicion || "N/D"}</p>
              <p class="text-xs text-gray-500">${item.observaciones || ""}</p>
            </div>
          `;
                    cont.appendChild(div);
                });
            } catch (err) {
                console.error("cargarInventario:", err);
                safeEl("inventarioLista").innerHTML = "<p class='muted'>Error al cargar inventario (ver consola).</p>";
            }
        };

        // Inventario: agregar
        window.agregarInventario = async function agregarInventario() {
            try {
                const id = safeEl("instalacion").value;
                const nombre = safeEl("invNombre").value.trim();
                const cantidad = parseInt(safeEl("invCantidad").value || "0", 10);
                const estado = safeEl("invEstado").value.trim() || null;
                const condicion = safeEl("invCondicion").value.trim() || null;
                const observaciones = safeEl("invObs").value.trim() || null;

                if (!id) { alert("Seleccione una instalación"); return; }
                if (!nombre) { alert("Nombre requerido"); return; }
                if (!cantidad || cantidad <= 0) { alert("Cantidad debe ser mayor que 0"); return; }

                const { error } = await supabase.from("inventario_instalacion").insert({
                    instalacion_id: id,
                    nombre,
                    cantidad,
                    estado,
                    condicion,
                    observaciones
                });

                if (error) throw error;

                safeEl("invNombre").value = "";
                safeEl("invCantidad").value = "";
                safeEl("invEstado").value = "";
                safeEl("invCondicion").value = "";
                safeEl("invObs").value = "";

                await cargarInventario();
            } catch (err) {
                console.error("agregarInventario:", err);
                alert("Error al guardar (ver consola).");
            }
        };

        window.refrescarInventario = function refrescarInventario() {
            cargarInventario();
        };

        // Mantenimientos: listar
        window.cargarMantenimientos = async function cargarMantenimientos() {
            try {
                const id = safeEl("instalacion").value;
                if (!id) {
                    safeEl("mantenimientoLista").innerHTML = "<p class='muted'>Seleccione una instalación.</p>";
                    return;
                }
                const { data, error } = await supabase
                    .from("mantenimientos_instalacion")
                    .select("id, instalacion_id, fecha, tipo, responsable, detalles, created_at")
                    .eq("instalacion_id", id)
                    .order("fecha", { ascending: false });
                if (error) throw error;
                const cont = safeEl("mantenimientoLista");
                cont.innerHTML = "";
                if (!data || data.length === 0) {
                    cont.innerHTML = "<p class='muted'>No hay mantenimientos.</p>";
                    return;
                }
                data.forEach(m => {
                    const div = document.createElement("div");
                    div.className = "p-3 rounded bg-white/5 flex justify-between";
                    div.innerHTML = `
            <div>
              <p class="font-semibold">${m.tipo}</p>
              <p class="text-sm text-gray-400">Fecha: ${m.fecha || "N/D"} • Responsable: ${m.responsable || "N/D"}</p>
              <p class="text-xs text-gray-500">${m.detalles || ""}</p>
            </div>
            <button class="text-sm text-blue-400" onclick="abrirModalMantenimiento('${m.id}')">Editar</button>
          `;
                    cont.appendChild(div);
                });
            } catch (err) {
                console.error("cargarMantenimientos:", err);
                safeEl("mantenimientoLista").innerHTML = "<p class='muted'>Error al cargar mantenimientos (ver consola).</p>";
            }
        };

        // Modal: abrir (crear o editar)
        window.abrirModalMantenimiento = async function abrirModalMantenimiento(id = null) {
            const modal = document.getElementById("modalEditarMantenimiento");
            const titulo = document.getElementById("modalMantTitulo");
            const selInst = safeEl("instalacion");
            const instalacionId = selInst.value;

            if (!instalacionId) {
                alert("Primero seleccione una instalación.");
                return;
            }

            // Set modo
            modal.dataset.mode = id ? "edit" : "create";
            modal.dataset.id = id ? String(id) : "";

            // Limpia campos
            document.getElementById("modalMantTipo").value = "";
            document.getElementById("modalMantFecha").value = "";
            document.getElementById("modalMantResp").value = "";
            document.getElementById("modalMantDetalles").value = "";

            if (id) {
                // EDITAR
                titulo.textContent = "Editar mantenimiento";
                try {
                    const { data, error } = await supabase
                        .from("mantenimientos_instalacion")
                        .select("*")
                        .eq("id", id)
                        .single();
                    if (error) throw error;

                    document.getElementById("modalMantTipo").value = data.tipo || "";
                    document.getElementById("modalMantFecha").value = data.fecha || "";
                    document.getElementById("modalMantResp").value = data.responsable || "";
                    document.getElementById("modalMantDetalles").value = data.detalles || "";
                } catch (err) {
                    console.error("abrirModalMantenimiento:", err);
                    alert("Error al cargar mantenimiento para edición.");
                    return;
                }
            } else {
                // CREAR
                titulo.textContent = "Nuevo mantenimiento";
                // Opcional: fecha de hoy
                const hoy = new Date().toISOString().slice(0, 10);
                document.getElementById("modalMantFecha").value = hoy;
            }

            modal.style.display = "flex";
        };

        window.cerrarModalMantenimiento = function cerrarModalMantenimiento() {
            const modal = document.getElementById("modalEditarMantenimiento");
            modal.style.display = "none";
            modal.dataset.id = "";
            modal.dataset.mode = "";
        };

        // Guardar cambios (create/update)
        window.guardarCambiosMantenimiento = async function guardarCambiosMantenimiento() {
            try {
                const modal = document.getElementById("modalEditarMantenimiento");
                const mode = modal.dataset.mode || "create";
                const id = parseInt(modal.dataset.id || "0", 10);
                const selInst = safeEl("instalacion");
                const instalacionId = selInst.value;

                if (!instalacionId) {
                    alert("Primero seleccione una instalación.");
                    return;
                }

                const tipo = document.getElementById("modalMantTipo").value.trim();
                const fecha = document.getElementById("modalMantFecha").value || null;
                const responsable = document.getElementById("modalMantResp").value.trim() || null;
                const detalles = document.getElementById("modalMantDetalles").value.trim() || null;

                if (!tipo) { alert("Tipo de mantenimiento requerido"); return; }

                if (mode === "edit" && id) {
                    const { error } = await supabase
                        .from("mantenimientos_instalacion")
                        .update({ tipo, fecha, responsable, detalles })
                        .eq("id", id);

                    if (error) throw error;
                } else {
                    const { error } = await supabase
                        .from("mantenimientos_instalacion")
                        .insert({
                            instalacion_id: instalacionId,
                            tipo,
                            fecha,
                            responsable,
                            detalles
                        });

                    if (error) throw error;
                }

                cerrarModalMantenimiento();
                await cargarMantenimientos();
            } catch (err) {
                console.error("guardarCambiosMantenimiento:", err);
                alert("Error al guardar cambios (ver consola).");
            }
        };

        // Tabs
        window.cambiarTab = function cambiarTab(tab) {
            const inv = document.getElementById("panelInventario");
            const mant = document.getElementById("panelMantenimiento");
            const tInv = document.getElementById("tabInventario");
            const tMant = document.getElementById("tabMantenimiento");

            if (tab === "inv") {
                inv.classList.remove("hidden");
                mant.classList.add("hidden");
                tInv.classList.add("tab-active");
                tMant.classList.remove("tab-active");
            } else {
                inv.classList.add("hidden");
                mant.classList.remove("hidden");
                tInv.classList.remove("tab-active");
                tMant.classList.add("tab-active");
            }
        };

        // Sidebar: instalaciones + logout
        const sidebarInstList = document.getElementById("instList");
        const btnToggleInst = document.getElementById("toggleInst");
        const chev = document.getElementById("chev");
        const btnLogout = document.getElementById("btnLogout");

        if (btnToggleInst && sidebarInstList && chev) {
            btnToggleInst.addEventListener("click", () => {
                sidebarInstList.classList.toggle("hidden-el");
                chev.classList.toggle("rotate-180");
            });
        }

        async function cargarInstalacionesSidebar() {
            if (!sidebarInstList) return;

            const { data, error } = await supabase
                .from("instalaciones")
                .select("nombre,codigo")
                .order("nombre");

            if (error || !data) return;

            sidebarInstList.innerHTML = "";
            data.forEach(inst => {
                const a = document.createElement("a");
                a.href = `instalacion.html?codigo=${encodeURIComponent(inst.codigo)}`;
                a.className = "menu-item";
                a.textContent = inst.nombre;
                sidebarInstList.appendChild(a);
            });
        }

        if (btnLogout) {
            btnLogout.addEventListener("click", async () => {
                await supabase.auth.signOut();
                window.location.href = "inicio.html";
            });
        }

        // Eventos
        document.getElementById("instalacion").addEventListener("change", () => {
            actualizarInfoInstalacion();
            cargarInventario();
            cargarMantenimientos();
        });

        window.addEventListener("DOMContentLoaded", () => {
            cargarInstalaciones();
            cargarInstalacionesSidebar();
        });

    </script>
</body>

</html>